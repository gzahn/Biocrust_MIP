# facet_wrap(~group) +
labs(y="f(Mg)",x="Mg",color="Treatment")
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.1) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c('dotted',rep('solid',3)))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c('dotted',rep('solid',3)))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(2,1,1,1))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(211,1,1,1))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(121,1,1,1))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(11,1,1,1))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(22,1,1,1))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(2,1,1,1))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c('dotted',1,1,1))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1))
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1),guides='none')
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p1 <- isplines %>%
ggplot(aes(x=geographic_actual*10000,y=geographic_partial,color=group)) +
geom_smooth(se=FALSE,linewidth=2,alpha=.75) +
scale_color_manual(values=pal$pal.okabe) +
labs(y="f(Geographic distance)",x="Geographic distance (m)",color="Taxa") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p2 <- isplines %>%
ggplot(aes(x=Ca_actual,y=Ca_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Ca)",x="Ca",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p1
p2 <- isplines %>%
ggplot(aes(x=Ca_actual,y=Ca_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Ca)",x="Ca",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p3 <- isplines %>%
ggplot(aes(x=NO3_actual,y=NO3_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(NO3)",x="NO3",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p4 <- isplines %>%
ggplot(aes(x=P_actual,y=P_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(P)",x="P",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p5 <- isplines %>%
ggplot(aes(x=pH_actual,y=pH_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(pH)",x="pH",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p6 <- isplines %>%
ggplot(aes(x=Mg_actual,y=Mg_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Mg)",x="Mg",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=pal$pal.okabe) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
p1 <- isplines %>%
ggplot(aes(x=geographic_actual*10000,y=geographic_partial,color=group)) +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
labs(y="f(Geographic distance)",x="Geographic distance (m)",color="Taxa") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p1
p1 <- isplines %>%
ggplot(aes(x=geographic_actual*10000,y=geographic_partial,color=group)) +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
labs(y="f(Geographic distance)",x="Geographic distance (m)",color="Taxa") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p2 <- isplines %>%
ggplot(aes(x=Ca_actual,y=Ca_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(Ca)",x="Ca",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p3 <- isplines %>%
ggplot(aes(x=NO3_actual,y=NO3_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(NO3)",x="NO3",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p4 <- isplines %>%
ggplot(aes(x=P_actual,y=P_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(P)",x="P",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p5 <- isplines %>%
ggplot(aes(x=pH_actual,y=pH_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(pH)",x="pH",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p6 <- isplines %>%
ggplot(aes(x=Mg_actual,y=Mg_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(Mg)",x="Mg",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
# theme
theme_set(theme_bw() +
theme(strip.text = element_text(face='bold',size=14),
legend.title = element_text(face='bold',size=14),
axis.title = element_text(face='bold',size=14),
axis.text = element_text(face='bold',size=10)
)
)
p1 <- isplines %>%
ggplot(aes(x=geographic_actual*10000,y=geographic_partial,color=group)) +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
labs(y="f(Geographic distance)",x="Geographic distance (m)",color="Taxa") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p2 <- isplines %>%
ggplot(aes(x=Ca_actual,y=Ca_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(Ca)",x="Ca",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p3 <- isplines %>%
ggplot(aes(x=NO3_actual,y=NO3_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(NO3)",x="NO3",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p4 <- isplines %>%
ggplot(aes(x=P_actual,y=P_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(P)",x="P",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p5 <- isplines %>%
ggplot(aes(x=pH_actual,y=pH_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(pH)",x="pH",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p6 <- isplines %>%
ggplot(aes(x=Mg_actual,y=Mg_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(Mg)",x="Mg",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
p7 <- isplines %>%
ggplot(aes(x=Fe_actual,y=Fe_partial,color=group)) +
# geom_vline(xintercept = 100,linetype=2,color='gray') +
geom_smooth(se=FALSE,linewidth=2,alpha=.75,aes(linetype=group)) +
scale_color_manual(values=c("gray20",pal$pal.earthtones)) +
# facet_wrap(~group) +
labs(y="f(Fe)",x="Fe",color="Treatment") +
scale_linetype_manual(values = c(21,1,1,1)) + guides(linetype = "none")
(p2 | p3) / (p4 | p5) / (p6 | p7) + plot_layout(guides='collect')
ggsave("./output/figs/GDM_splines_plots_soilvars.png",dpi=400,height = 8,width = 12)
## Packages
library(readxl)
library(tidyverse)
## Functions ####
source("./R/functions.R")
## Metadata ####
dat <- read_xlsx("./data/full_metadata.xlsx")
## Variables ####
dl_path_18S <- "./data/seq/18S"
accessions_18S <- dat$sra_accession
fwd_filenames_18S <- file.path(dl_path_18S,dat$fwd_name)
rev_filenames_18S <- file.path(dl_path_18S,dat$rev_name)
dl_filenames_fwd <- paste0(accessions_18S,"_1.fastq")
dl_filenames_rev <- paste0(accessions_18S,"_2.fastq")
accessions_18S
accessions_18S[1]
i=1
system2("fasterq-dump",args = accessions_18S[i])
system2("fasterq-dump")
# Download from SRA ####
system("fasterq-dump")
# Download from SRA ####
system2("fasterq-dump")
# Download from SRA ####
system("fasterq-dump")
# Download from SRA ####
system2("fasterq-dump")
# Download from SRA ####
system2("fasterq-dump")
system("fasterq-dump")
system("ls")
system("/home/gzahn/Programs/sratoolkit.3.1.1-ubuntu64/bin/fasterq-dump")
system2("/home/gzahn/Programs/sratoolkit.3.1.1-ubuntu64/bin/fasterq-dump")
system2("fasterq-dump")
system2("which",args = "fasterq-dump")
# Download from SRA ####
system("which fasterq-dump")
# Download from SRA ####
system("which ls")
system2("which",args = "ls")
fasterq_dump <- "/home/gzahn/Programs/sratoolkit.3.1.1-ubuntu64/bin/fasterq-dump"
i
system2(fasterq_dump,args = accessions_18S[i])
dat$bioproject_accession...98
ps@sam_data$ca
data.frame(
ca=ps@sam_data$ca,
treatment=ps@sam_data$invasion
)
data.frame(
ca=ps@sam_data$ca,
treatment=ps@sam_data$invasion
) %>%
ggplot(aes(x=treatment,y=ca)) +
geom_boxplot()
# SETUP ####
# packages
library(tidyverse)
library(phyloseq)
library(vegan)
library(lmerTest)
library(corncob)
library(patchwork)
library(broom)
library(gdm)
# functions
source("./R/functions.R")
# variables
set.seed(666)
# theme
theme_set(theme_bw() +
theme(strip.text = element_text(face='bold',size=14),
legend.title = element_text(face='bold',size=14),
axis.title = element_text(face='bold',size=14),
axis.text = element_text(face='bold',size=10)
)
)
# data
ps <- readRDS("./data/physeq_18S_clean.RDS")
# "OTU Table matrix"
mat <-
ps %>%
transform_sample_counts(ra) %>%
otu_table() %>%
as('matrix')
data.frame(
om=ps@sam_data$om,
treatment=ps@sam_data$invasion
) %>%
ggplot(aes(x=treatment,y=ca)) +
geom_boxplot()
data.frame(
om=ps@sam_data$om,
treatment=ps@sam_data$invasion
) %>%
ggplot(aes(x=treatment,y=om)) +
geom_boxplot()
#SETUP ####
library(tidyverse)
library(janitor)
library(DESeq2) # https://bioconductor.org/packages/devel/bioc/vignettes/DESeq2/inst/doc/DESeq2.html
# functions
read_stats <- function(x){
sampleid <- x %>% basename() %>% str_remove("_scafstats.txt|_refstats.txt")
dat <- read_delim(x) %>% clean_names() %>% mutate(sample_id=sampleid)
names(dat)[1] <- "full_name"
dat <-
dat %>%
mutate(uniprot_id = full_name %>% str_split("\\|") %>% map_chr(1),
predicted_gene = full_name %>% str_split("\\|") %>% map_chr(2)) %>%
dplyr::select(sample_id, predicted_gene, uniprot_id, unambiguous_reads)
return(dat)
}
read_annot <- function(x){
dat <- read_delim(x,delim = "\t",skip = 1,col_names = FALSE)
sampleid <- x %>% basename() %>% str_remove("_annotation_table.tsv")
header <- readLines(x)[1] %>%
str_squish() %>%
str_split("\\s") %>%
unlist()
colnames(dat) <- header
dat$sample_id=sampleid
return(dat)
}
# file paths
path <- "~/Desktop/Mangrove_Annotations"
# scaffold stats
scafstats_fp <- list.files(path,full.names = TRUE, pattern = "scafstats.txt")
# reference stats (overall for that file, might be handy)
refstats_fp <- list.files(path,full.names = TRUE, pattern = "refstats.txt")
# annotation tables
annot_fp <- list.files(path,full.names = TRUE, pattern = "annotation_table.tsv")
# sample names
sample_names <- basename(annot_fp) %>% str_remove("_annotation_table.tsv")
# subset to remove scafstats files that have no corresponding annotation file
scafstats_fp <- grep(x = scafstats_fp,pattern = paste(sample_names,collapse = "|"),value = TRUE)
# read in delim files
scafstats <- map(scafstats_fp,read_stats)
refstats <- map(refstats_fp,read_delim) %>% purrr::reduce(full_join) %>% clean_names()
View(refstats)
names(scafstats) <- sample_names
annotations <- map(annot_fp,read_annot)
# stick them all together
dat <-
full_join(
purrr::reduce(scafstats,full_join),
purrr::reduce(annotations,full_join)
)
View(dat)
# build gene_metadata
uniprot_meta <-
dat %>%
dplyr::select(uniprot_id,ko_id,ko_description,pfam_id,pfam_description,go_term) %>%
unique.data.frame()
# build sample metadata
sample_meta <-
data.frame(
sample_id = dat$sample_id %>% unique
) %>%
mutate(location = sample_id %>%
str_split("_") %>%
map_chr(1),
location = case_when(location == "CJ" ~ "Chek Jawa",
location == "Sem" ~ "Semaku"),
plant_part = sample_id %>%
str_split("_") %>% map_chr(2),
plant_part = case_when(plant_part == "L" ~ "Leaf",
plant_part == "Pn" ~ "Pneumatophore",
plant_part == "Sed" ~ "Sediment"),
replicate = sample_id %>%
str_split("_") %>% map_chr(3))
# build count table (full)
count_tab <-
dat %>%
dplyr::select(sample_id, uniprot_id, unambiguous_reads) %>%
distinct(sample_id,uniprot_id, .keep_all = TRUE) %>%
pivot_wider(
names_from = sample_id,
values_from = unambiguous_reads)
# remove uniprot_ids that had no unambiguous mappings?
count_tab[count_tab %>%
dplyr::select(-uniprot_id) %>%
rowSums(na.rm = TRUE) > 0,]
# remove uniprot_ids that had no unambiguous mappings?
count_tab <-
count_tab[count_tab %>%
dplyr::select(-uniprot_id) %>%
rowSums(na.rm = TRUE) > 0,]
# convert to matrix
mat <-
count_tab %>%
dplyr::select(-uniprot_id) %>%
as.matrix
row.names(mat) <- count_tab$uniprot_id
# Convert NA to 0
mat[is.na(mat)] <- 0
# check order of input data
identical(
colnames(mat),
sample_meta$sample_id
)
saveRDS(mat,"./count_table.RDS")
saveRDS(sample_meta,"./sample_meta.RDS")
